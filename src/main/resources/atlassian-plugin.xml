<atlassian-plugin key="${project.groupId}.${project.artifactId}" name="Bitbucket Connector" plugins-version="2">
    <plugin-info>
        <description>${project.description}</description>
        <version>${project.version}</version>
        <vendor name="${project.organization.name}" url="${project.organization.url}"/>
    </plugin-info>

    <component-import key="templateRenderer"
                      interface="com.atlassian.templaterenderer.TemplateRenderer">
        <description>Template Renderer Factory</description>
    </component-import>

    <component-import key="ao" name="Active Objects" interface="com.atlassian.activeobjects.external.ActiveObjects">
        <description>Component to access Active Objects functionality from the plugin</description>
    </component-import>

    <ao key="ao-module" name="Active Objects Module">
        <entity>com.atlassian.jira.plugins.bitbucket.activeobjects.v1.ProjectMapping</entity>
        <entity>com.atlassian.jira.plugins.bitbucket.activeobjects.v1.IssueMapping</entity>
        <upgradeTask>com.atlassian.jira.plugins.bitbucket.property.PropertyMigrator</upgradeTask>
    </ao>

    <component key="executorService" name="Executor Service Factory Component"
            class="com.atlassian.jira.plugins.bitbucket.mapper.impl.DefaultExecutorServiceFactoryBean">
        <description>ExecutorService factory bean for creating executor services</description>
        <interface>com.atlassian.jira.plugins.bitbucket.mapper.ExecutorServiceFactoryBean</interface>
    </component>

    <component key="mapper" name="Bitbucket Mapper"
               class="com.atlassian.jira.plugins.bitbucket.mapper.impl.DefaultBitbucketMapper">
        <description>A Service for migrating from the property set storage to ActiveObjects</description>
        <interface>com.atlassian.jira.plugins.bitbucket.mapper.BitbucketMapper</interface>
    </component>

    <component key="synchronizer" name="Bitbucket Synchronization Service"
               class="com.atlassian.jira.plugins.bitbucket.mapper.impl.DefaultSynchronizer">
        <description>A Service for migrating from the property set storage to ActiveObjects</description>
        <interface>com.atlassian.jira.plugins.bitbucket.mapper.Synchronizer</interface>
    </component>

    <component key="encryptor" name="Encryption Service"
               class="com.atlassian.jira.plugins.bitbucket.mapper.impl.DefaultEncryptor">
        <description>A service for encrypting and decrypting passwords</description>
        <interface>com.atlassian.jira.plugins.bitbucket.mapper.Encryptor</interface>
    </component>

    <component key="bitbucketProjectSettings" name="Bitbucket Project Settings Component"
               class="com.atlassian.jira.plugins.bitbucket.property.DefaultBitbucketProjectSettings">
        <description>A facade for storing project settings</description>
        <interface>com.atlassian.jira.plugins.bitbucket.property.BitbucketProjectSettings</interface>
    </component>

    <component key="bitbucketConnection" name="Bitbucket Remote Connection"
               class="com.atlassian.jira.plugins.bitbucket.connection.impl.DefaultBitbucketConnection">
        <description>A component used to talk to the remote bitbucket service</description>
        <interface>com.atlassian.jira.plugins.bitbucket.connection.BitbucketConnection</interface>
    </component>

<!--    <component key="remoteBitbucket" name="Remote Bitbucket Service"
               class="com.atlassian.jira.plugins.bitbucket.bitbucket.impl.DefaultBitbucket">
        <description>A service for using the remove bitbucket connection</description>
        <interface>com.atlassian.jira.plugins.bitbucket.bitbucket.Bitbucket</interface>
    </component>-->

    <component-import key="pluginSettingsFactory">
        <interface>com.atlassian.sal.api.pluginsettings.PluginSettingsFactory</interface>
    </component-import>

    <component-import key="requestFactory">
        <interface>com.atlassian.sal.api.net.RequestFactory</interface>
    </component-import>

    <issue-tabpanel key="bitbucket-commits-tabpanel" name="BitBucket Changesets Tab Panel"
                    class="com.atlassian.jira.plugins.bitbucket.issuetabpanels.BitbucketTabPanel">

        <description>Show Bitbucket changesets related to an issue in an issue tab panel.</description>
        <label>Bitbucket</label>
        <resource type="velocity" name="view" location="templates/com/tsc/jira/github/issuetabpanels/view.vm"/>
    </issue-tabpanel>

    <!-- The webwork1 plugin element is how you add new actions to JIRA -->
    <webwork1 key="repositoryConfiguration" name="Repository Configuration" class="java.lang.Object">
        <!-- Note that HTML in the description element is ignored -->
        <description>
        </description>
        <actions>

            <action name="com.atlassian.jira.plugins.bitbucket.webwork.ConfigureBitbucketRepositories"
                    alias="ConfigureBitbucketRepositories" roles-required="admin">
                <view name="error">/templates/com/atlassian/jira/plugins/bitbucket/webwork/error.vm</view>
                <view name="input">/templates/com/atlassian/jira/plugins/bitbucket/webwork/input.vm</view>
                <view name="syncstatus">/templates/com/atlassian/jira/plugins/bitbucket/webwork/syncstatus.vm</view>
                <view name="syncmessage">/templates/com/atlassian/jira/plugins/bitbucket/webwork/syncmessage.vm</view>
                <view name="redirect">/templates/com/atlassian/jira/plugins/bitbucket/webwork/redirect.vm</view>
            </action>

            <action name="com.atlassian.jira.plugins.bitbucket.webwork.ViewProjectRepository"
                    alias="ViewProjectRepository" roles-required="admin">
                <view name="viewrepository">/templates/com/atlassian/jira/plugins/bitbucket/webwork/viewrepository.vm
                </view>
            </action>

            <action name="com.atlassian.jira.plugins.bitbucket.webwork.BitbucketPostCommit" alias="BitbucketPostCommit">
                <view name="postcommit">/templates/com/atlassian/jira/plugins/bitbucket/webwork/postcommit.vm</view>
            </action>

        </actions>
    </webwork1>

    <project-operation key="com.atlassian.jira.plugins.projectlink" name="Bitbucket Project Link"
                       class="com.atlassian.jira.plugins.bitbucket.links.ProjectSettings">
        <resource type="velocity" name="view" location="/templates/com/atlassian/jira/plugins/projectlinks/view.vm"/>
        <order>100</order>
    </project-operation>


    <web-section key="bitbucket" name="Bitbucket Admin" location="system.admin" weight="105">
        <description key="section.bitbucket.admin.desc">Authentication and Repository setup for the Bitbucket Connector
        </description>
        <label>Bitbucket</label>
        <name>Bitbucket Name Section</name>
    </web-section>

    <web-item key="bitbucket_bulk_repo" name="Bitbucket Bulk Repository" section="system.admin/bitbucket" weight="10">
        <description>Bulk Configure Bitbucket Repositories</description>
        <label>Bitbucket</label>

        <name>Bitbucket Name Item</name>

        <link>/secure/admin/ConfigureBitbucketRepositories!default.jspa</link>
        <condition class="com.atlassian.jira.plugin.webfragment.conditions.UserLoggedInCondition"/>

    </web-item>

    <resource type="download" name="images/" location="images/"/>

    <web-resource name="Resources" key="resources">
        <!--
         <resource name="javascripts/atlassian.js" type="download" location="javascripts/atlassian.js"/>
         <resource name="javascripts/datejs/date.js" type="download" location="javascripts/datejs/date.js"/>
         <resource name="javascripts/ajs.date.js" type="download" location="javascripts/ajs.date.js"/>
        -->

        <resource name="javascripts/bitbucket.js" type="download" location="javascripts/bitbucket.js"/>

        <context>atl.general</context>
        <context>atl.admin</context>
    </web-resource>


</atlassian-plugin>