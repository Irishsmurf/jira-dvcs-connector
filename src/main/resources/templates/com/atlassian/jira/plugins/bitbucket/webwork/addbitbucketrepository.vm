<html>
  <head>
    <title>Add new Bitbucket repository</title>

    <script type="text/javascript">
        var BASE_URL = "${baseurl}"
        function init_repositories()
        {
            AJS.$("#addPostCommitService").click(function(a){
                AJS.$("#postCommitServiceDetails").slideToggle()
                });
   
        }            
     </script>

  </head>

  <body>
    <form id="repoEntry" method="post" action="${baseurl}/secure/admin/AddBitbucketRepository.jspa" class="aui">
      <h2>New Bitbucket repository</h2>
      <input type="hidden" name="atl_token" value="$atl_token">
      <input type="hidden" name="isPrivate" value="$action.isPrivate()">

      <fieldset>
        <div class="field-group">
            <label for="repositoryUrl">Repository Url</label>
            <span class="field-value">$textutils.htmlEncode($action.getRepositoryUrl())</span>
            <input type="hidden" id="repositoryUrl" name="repositoryUrl" value="$textutils.htmlEncode($action.getRepositoryUrl())"/>
        </div>
        <div class="field-group">
            <label for="projectKey">Project Key</label>
            <input type="hidden" id="projectKey" name="projectKey" value="$textutils.htmlEncode($action.getProjectKey())"/>
            <span class="field-value">$textutils.htmlEncode($action.getProjectKey())</span>
        </div>
      </fieldset>

      #if ($action.isPrivate())
      <h3>Access credentials</h3>
      <div class="field-group">
        <label for="bbUsername">Username</label>
        <input type="text" name="bbUsername" id="bbUsername" value="$textutils.htmlEncode($action.getBbUsername())">
      </div>  
      <div class="field-group">
        <label for="bbPassword">Password</label>
        <input type="password" name="bbPassword" id="bbPassword" value="">
      </div>  
      #end

      #if ($action.addPostCommitService()) 
        #set ($checked = "checked") 
        #set ($hidden = "") 
      #else 
        #set ($checked = "") 
        #set ($hidden = "style='display:none'") 
      #end
      <h3>Repository Services</h3>
      <div class="checkbox">
        <input class="checkbox" type="checkbox" name="addPostCommitService" id="addPostCommitService" $checked>
        <label for="addPostCommitService">Install postcomit service</label>
        <div class="description">Installing postcommit service requires admin access to the repository.</div>
      </div>
      <div id="postCommitServiceDetails" $hidden>
      <div class="field-group">
        <label for="adminUsername">Admin username</label>
        <input type="text" name="adminUsername" id="adminUsername" value="$textutils.htmlEncode($action.getAdminUsername())">
      </div>  
      <div class="field-group">
        <label for="adminPassword">Admin password</label>
        <input type="password" name="adminPassword" id="adminPassword" value="">
      </div>  
      </div>  
      <div id="aui-message-bar">
        #foreach ($errorMessage in $action.getErrorMessages())
        <div class="aui-message error">
            <p class="title">
                <span class="aui-icon icon-error"></span>
                <strong>Error!</strong>
            </p>
            <p>$errorMessage</p>
        </div>                       
        #end
      </div>
      <div class="buttons-container">
        <div class="buttons">
          <div>&nbsp;</div>
            <input type="submit" name="Submit" id="Submit" value="Add Repository"/>
            <a class="cancel" href="${baseurl}/secure/admin/ConfigureBitbucketRepositories.jspa?atl_token=${atl_token}">Cancel</a>
            <a class="cancel" onclick="history.back();">Go Back</a>
        </div>
      </div>
    
  </form>      
  </body>
</html>